import os
import json

from IPython import embed

from utils import load_annos, save_annos


def f_label_map(annos, mapper):
    out = []
    for anno in annos:
        img_w = anno['img_w']
        img_h = anno['img_h']
        img_name = anno['img_name']
        bboxes = anno['bboxes']
        new_bboxes = []
        for box in bboxes:
            label = box[4]
            if label in mapper:
                box[4] = mapper[label]
                new_bboxes.append(box)
        out.append({
            'img_name': img_name,
            'bboxes': new_bboxes,
            'img_w': img_w,
            'img_h': img_h
        })
    return out

label_map = {1: '人',
 104: '动物',
 274: '动物',
 57: '动物',
 137: '动物',
 165: '动物',
 320: '动物',
 222: '动物',
 263: '动物',
 242: '动物',
 322: '动物',
 93: '动物',
 79: '动物',
 97: '动物',
 325: '动物',
 181: '动物',
 345: '动物',
 319: '动物',
 342: '动物',
 308: '动物',
 140: '动物',
 145: '动物',
 100: '动物',
 301: '动物',
 343: '动物',
 324: '动物',
 296: '动物',
 241: '动物',
 179: '动物',
 331: '动物',
 354: '动物',
 350: '动物',
 321: '动物',
 327: '动物',
 258: '动物',
 279: '动物',
 359: '动物',
 312: '动物',
 116: '电子产品', # 动物 -> 电子产品 V2
 112: '食物',
 153: '食物',
 234: '食物',
 348: '食物',
 361: '食物',
 297: '食物',
 262: '食物',
 118: '食物',
 182: '食物',
 217: '食物',
 337: '食物',
 265: '食物',
 292: '食物',
 159: '食物',
 108: '食物',
 142: '食物',
 261: '食物',
 346: '食物',
 260: '食物',
 196: '食物',
 83: '食物',
 105: '食物',
 224: '食物',
 251: '食物',
 299: '食物',
 310: '食物',
 334: '食物',
 136: '食物',
 113: '食物',
 237: '食物',
 275: '食物',
 289: '食物',
 272: '食物',
 360: '食物',
 156: '食物',
 180: '食物',
 199: '食物',
 283: '食物',
 247: '食物',
 318: '食物',
 290: '食物',
 98: '食物',
 218: '食物',
 353: '食物',
 281: '食物',
 267: '食物',
 175: '食物',
 65: '食物',
 330: '食物',
 172: '食物',
 238: '食物',
 314: '食物',
 286: '食物',
 304: '食物',
 188: '食物',
 235: '食物',
 351: '食物',
 186: '食物',
 280: '食物',
 228: '食物',
 151: '食物',
 201: '食物',
 63: '食物',
 341: '食物',
 266: '食物',
 129: '食物',
 183: '食物',
 338: '食物',
 305: '食物',
 231: '食物',
 144: '食物',
 4: '服饰',
 2: '服饰',
 23: '服饰',
 30: '服饰',
 46: '服饰',
 52: '服饰',
 58: '服饰',
 149: '服饰',
 44: '服饰',
 152: '服饰',
 209: '服饰',
 5: '服饰',
 18: '服饰',
 20: '服饰',
 37: '服饰',
 195: '服饰',
 239: '服饰',
 39: '服饰',
 14: '服饰',
 121: '服饰',
 117: '交通工具',
 212: '交通工具',
 73: '交通工具',
 22: '交通工具',
 6: '交通工具',
 35: '交通工具',
 56: '交通工具',
 66: '交通工具',
 88: '交通工具',
 127: '交通工具',
 309: '交通工具',
 249: '交通工具',
 189: '交通工具',
 200: '交通工具',
 110: '交通工具',
 50: '交通工具',
 47: '交通工具',
 59: '交通工具',
 130: '交通工具',
 184: '交通工具',
 125: '交通工具',
 131: '交通工具',
 193: '交通工具',
 115: '交通工具',
 264: '交通工具',
 216: '交通工具',
 273: '交通工具',
 132: '交通工具',
 313: '交通工具',
 54: '乐器',
 143: '乐器',
 230: '乐器',
 271: '乐器',
 68: '乐器',
 225: '乐器',
 246: '乐器',
 316: '乐器',
 60: '乐器',
 185: '乐器',
 256: '乐器',
 340: '乐器',
 157: '运动器械',
 119: '运动器械',
 190: '运动器械',
 207: '运动器械',
 240: '运动器械',
 211: '运动器械',
 365: '运动器械',
 178: '运动器械',
 166: '运动器械',
 248: '运动器械',
 254: '运动器械',
 332: '运动器械',
 205: '运动器械',
 364: '运动器械',
 120: '运动器械',
 146: '运动器械',
 138: '运动器械',
 194: '运动器械',
 87: '运动器械',
 114: '运动器械',
 220: '运动器械',
 323: '运动器械',
 355: '运动器械',
 349: '运动器械',
 174: '运动器械',
 147: '运动器械',
 86: '运动器械',
 288: '运动器械',
 335: '运动器械',
 339: '运动器械',
 277: '运动器械',
 32: '电子产品',
 160: '电子产品',
 92: '电子产品',
 244: '电子产品',
 126: '电子产品',
 259: '电子产品',
 42: '电子产品',
 133: '电子产品',
 74: '电子产品',
 219: '电子产品',
 139: '电子产品',
 295: '电子产品',
 38: '电子产品',
 203: '电子产品',
 64: '电子产品',
 223: '电子产品',
 276: '电子产品',
 285: '电子产品',
 62: '电子产品',
 208: '电子产品',
 107: '电子产品',
 191: '电子产品',
 45: '办公用品',
 358: '办公用品',
 102: '办公用品',
 55: '办公用品',
 124: '办公用品',
 170: '办公用品',
 171: '办公用品',
 198: '办公用品',
 232: '办公用品',
 307: '办公用品',
 300: '办公用品',
 344: '办公用品',
 206: '办公用品',
 282: '办公用品',
 298: '办公用品',
 243: '办公用品',
 317: '办公用品',
 303: '办公用品',
 347: '办公用品',
 328: '办公用品',
 293: '办公用品',
 284: '办公用品',
 287: '办公用品',
 173: '办公用品',
 257: '办公用品',
 357: '办公用品',
 187: '办公用品',
 19: '办公用品',
 333: '办公用品',
 40: '办公用品',
 252: '办公用品',
 3: '家具家电',
 10: '家具家电',
 25: '家具家电',
 51: '家具家电',
 48: '家具家电',
 99: '家具家电',
 76: '家具家电',
 169: '家具家电',
 122: '家具家电',
 168: '家具家电',
 13: '家具家电',
 7: '家具家电',
 311: '家具家电',
 315: '家具家电',
 236: '家具家电',
 214: '家具家电',
 278: '家具家电',
 164: '家具家电',
 134: '家具家电',
 135: '家具家电',
 269: '家具家电',
 210: '家具家电',
 150: '家具家电',
 84: '家具家电',
 202: '家具家电',
 221: '家具家电',
 329: '家具家电',
 101: '家具家电',
 80: '家具家电',
 95: '家具家电',
 61: '家具家电',
 81: '家具家电',
 21: '家具家电',
 17: '家具家电',
 111: '家具家电',
 176: '家具家电',
 72: '家具家电',
 103: '家具家电',
 29: '家具家电',
 9: '厨具',
 291: '厨具',
 167: '厨具',
 94: '厨具',
 96: '厨具',
 36: '厨具',
 11: '厨具',
 141: '厨具',
 85: '厨具',
 158: '厨具',
 89: '厨具',
 16: '厨具',
 163: '厨具',
 204: '厨具',
 27: '厨具',
 123: '厨具',
 77: '浴室用品',
 227: '浴室用品',
 302: '浴室用品',
 270: '浴室用品',
 161: '浴室用品',
 226: '浴室用品',
 336: '浴室用品',
 294: '浴室用品',
 82: '浴室用品',
 192: '浴室用品',
 154: '浴室用品',
 326: '浴室用品',
 162: '浴室用品',
 106: '浴室用品',
 70: '浴室用品',
 33: '首饰',
 43: '首饰',
 34: '首饰',
 15: '首饰',
 8: '首饰',
 356: '化妆品',
 362: '化妆品',
 363: '化妆品',
 352: '化妆品',
 245: '化妆品',
 71: '玩具',
 91: '玩具',
 155: '玩具',
 -1: 'ignore'}

label2id_map = {'人': 1,
 '动物': 2,
 '食物': 3,
 '服饰': 4,
 '交通工具': 5,
 '乐器': 6,
 '运动器械': 7,
 '电子产品': 8,
 '办公用品': 9,
 '家具家电': 10,
 '厨具': 11,
 '浴室用品': 12,
 '首饰': 13,
 '化妆品': 14,
 '玩具': 15,
 'ignore': -1}


label_id_map = {}
for key, value in label_map.items():
    label_id_map[key] = label2id_map[value]

# embed()
annos = load_annos('/home/liwang/data/general_det/object365/val/anno.txt')
annos = f_label_map(annos, label_id_map)
save_annos(annos, '/home/liwang/data/general_det/object365/val/anno_15class_v2.txt')





